description: >
  A single, complete job to run Cypress tests

parameters:
  working_directory:
    description: Directory containing package.json
    type: string
    default: "."
  start_command:
    description: Command used to start your local dev server for Cypress to tests against
    type: string
    default: ""
  cypress_command:
    description: Command used to run your Cypress tests
    type: string
    default: "npx cypress run"

steps:
  - when:
      condition: << parameters.start_command >>
      steps:
        - run:
            name: Start Server
            command: << parameters.start_command >>
            background: true
            working_directory: << parameters.working_directory >>
  - run:
      name: Run Cypress
      command: << parameters.cypress_command >>
      working_directory: << parameters.working_directory >>
  - store_artifacts:
      path: << parameters.working_directory >>/cypress/videos
  - store_artifacts:
      path: << parameters.working_directory >>/cypress/screenshots
